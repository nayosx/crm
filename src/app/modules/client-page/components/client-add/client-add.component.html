<h2>Crear Cliente</h2>

<div class="grid">
  <!-- Fila 1: Formulario Cliente -->
  <div class="col-12 md:col-6 mb-4">
    <p-card header="Información del Cliente" class="border-round shadow-2">
      <app-client-form
        [loading]="loading"
        [disabled]="!!clientIdCreated"
        (submitForm)="onSubmit($event)"
      ></app-client-form>

      <div class="flex gap-2 mt-4" *ngIf="clientIdCreated">
        <button
          pButton
          label="Teléfono"
          icon="pi pi-phone"
          (click)="phoneDialogVisible = true"
        ></button>
        <button
          pButton
          label="Dirección"
          icon="pi pi-address-book"
          (click)="addressDialogVisible = true"
        ></button>
      </div>
    </p-card>
  </div>

  <div class="col-12 md:col-6 mb-4" *ngIf="clientIdCreated">
    <!-- Diálogo Teléfono -->
    <p-dialog
      [(visible)]="phoneDialogVisible"
      [modal]="true"
      [style]="{ width: '40rem' }"
      header="Teléfono"
      (onHide)="onCancelEditPhone()"
    >
      <app-client-phone-input
        [clientId]="clientIdCreated"
        [phoneToEdit]="selectedPhone"
        (phoneSaved)="onPhoneSaved()"
      ></app-client-phone-input>
    </p-dialog>
  </div>

  <!-- Lista Teléfonos -->
  <div class="col-12 md:col-6 mb-4" *ngIf="clientIdCreated">
    <p-card header="Lista de Teléfonos" class="border-round shadow-2">
      <ng-container *ngIf="phones$ | async as phones">
        <app-client-phone-list
          [phones]="getClientPhones(phones)"
          [loading]="(loadingPhones$ | async) ?? false"
          (edit)="onEditPhone($event)"
          (delete)="onDeletePhone($event)"
        ></app-client-phone-list>
      </ng-container>
    </p-card>
  </div>

  <!-- Diálogo Dirección -->
  <div class="col-12 md:col-6 mb-4" *ngIf="clientIdCreated">
    <p-dialog
      [(visible)]="addressDialogVisible"
      [modal]="true"
      [style]="{ width: '40rem' }"
      header="Dirección"
      (onHide)="onCancelEditAddress()"
    >
      <app-client-address-input
        [clientId]="clientIdCreated"
        [addressToEdit]="selectedAddress"
        (addressSaved)="onAddressSaved()"
      ></app-client-address-input>
    </p-dialog>
  </div>

  <!-- Lista Direcciones -->
  <div class="col-12 md:col-6 mb-4" *ngIf="clientIdCreated">
    <p-card header="Lista de Direcciones" class="border-round shadow-2">
      <ng-container *ngIf="addresses$ | async as addresses">
        <app-client-address-list
          [addresses]="getClientAddresses(addresses)"
          [loading]="(loadingAddresses$ | async) ?? false"
          (edit)="onEditAddress($event)"
          (delete)="onDeleteAddress($event)"
        ></app-client-address-list>
      </ng-container>
    </p-card>
  </div>
</div>
