<div class="flex align-items-center gap-2 pt-4 pb-4" >
    <h2 class="pl-4">
      <app-back-button [path]="'/clients'"  />Editar Cliente
    </h2>
</div>

<div *ngIf="client" class="grid">
  <!-- Formulario Cliente -->
  <div class="col-12 md:col-6 mb-2">
    <p-card header="Información del Cliente" class="border-round shadow-2">
      <app-client-form [client]="client" [loading]="loading" (submitForm)="onSubmit($event)"></app-client-form>
    </p-card>
  </div>
  <div class="col-12 p-0 m-0"></div>

  <!-- Teléfonos -->
  <div class="col-12 md:col-6 mb-2">
    <p-card class="border-round shadow-2">
      <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center w-full p-card-custom-header p-card-title pb-2 border-bottom-1 surface-border">
          <span>Lista de Teléfonos</span>
          <button pButton icon="pi pi-plus" class="p-button-sm" severity="secondary"
            (click)="phoneDialogVisible = true"></button>
        </div>
      </ng-template>

      <ng-container *ngIf="phones$ | async as phones">
        <app-client-phone-list [phones]="getClientPhones(phones)" [loading]="(loadingPhones$ | async) ?? false"
          (edit)="onEditPhone($event)" (delete)="onDeletePhone($event)"></app-client-phone-list>
      </ng-container>
    </p-card>
  </div>
  <div class="col-12 p-0 m-0"></div>

  <!-- Direcciones -->
  <div class="col-12 md:col-6 mb-2">
    <p-card class="border-round shadow-2">
      <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center w-full p-card-custom-header p-card-title pb-2 border-bottom-1 surface-border">
          <span>Lista de Direcciones</span>
          <button pButton icon="pi pi-plus" class="p-button-sm" severity="secondary"
            (click)="addressDialogVisible = true"></button>
        </div>
      </ng-template>

      <ng-container *ngIf="addresses$ | async as addresses">
        <app-client-address-list [addresses]="getClientAddresses(addresses)"
          [loading]="(loadingAddresses$ | async) ?? false" (edit)="onEditAddress($event)"
          (delete)="onDeleteAddress($event)"></app-client-address-list>
      </ng-container>
    </p-card>
  </div>

  <p-dialog [(visible)]="addressDialogVisible" [modal]="true" [style]="{ width: '40rem' }" header="Dirección"
    (onHide)="onCancelEditAddress()">
    <app-client-address-input [clientId]="client.id" [addressToEdit]="selectedAddress"
      (addressSaved)="onAddressSaved()"></app-client-address-input>
  </p-dialog>
  <p-dialog [(visible)]="phoneDialogVisible" [modal]="true" [style]="{ width: '40rem' }" header="Teléfono"
    (onHide)="onCancelEditPhone()">
    <app-client-phone-input [clientId]="client.id" [phoneToEdit]="selectedPhone"
      (phoneSaved)="onPhoneSaved()"></app-client-phone-input>
  </p-dialog>
</div>