<div class="flex align-items-center gap-2 mb-3">
    <input pInputText type="text" class="w-full p-inputtext-sm" placeholder="Buscar cliente..."
        (input)="onSearch($any($event.target).value)" />
    <button pButton icon="pi pi-refresh" (click)="onReload()"></button>
</div>

<div *ngIf="clients$ | async as data">
    <ul class="list-none p-0">
        <li *ngFor="let client of data.items"
            class="flex justify-content-between align-items-center border-bottom-1 surface-border py-2 flex-wrap gap-2">
            <div class="flex align-items-center gap-2">
                <p-avatar [label]="getInitials(client.name)" />
                <span class="font-medium">{{ client.name }}</span>
            </div>

            <button *ngIf="!showActions" pButton icon="pi pi-check" severity="info" (click)="onSelectClient(client)"></button>

            <ng-container *ngIf="showActions">
                <div class="hidden md:flex gap-2">
                    <button pButton icon="pi pi-search" label="Ver Detalle" class="p-button-sm p-button-info"
                        (click)="onViewDetail(client.id)"></button>
                    <button pButton icon="pi pi-pencil" label="Editar" class="p-button-sm p-button-secondary"
                        (click)="onEdit(client.id)"></button>

                </div>

                <div class="flex md:hidden">
                    <p-menu #menu [model]="getClientActions(client.id)" [popup]="true"></p-menu>
                    <p-button icon="pi pi-ellipsis-v" (click)="menu.toggle($event)" class="p-button-sm p-button-text"
                        severity="secondary"></p-button>
                </div>
            </ng-container>
        </li>
    </ul>

    <p-paginator class="mt-3" [first]="(data.current_page - 1) * data.per_page" [rows]="data.per_page"
        [totalRecords]="data.total" (onPageChange)="onPrimePageChange($event)"></p-paginator>
</div>

<app-loader-dialog></app-loader-dialog>

<ng-container *ngIf="selectedClient">
    <p-dialog [(visible)]="detailDialogVisible" [modal]="true" [style]="{ width: '30rem' }" header="Detalle del Cliente"
        (onHide)="onCloseDetail()">
        <app-client-detail [client]="selectedClient" [useCard]="false"></app-client-detail>
    </p-dialog>
</ng-container>